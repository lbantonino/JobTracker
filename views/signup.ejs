<%- include('partials/header'); -%>

  <div class="form-card">
    <div class="form-square">

      <form class="form-login1">
        <!-- <h2>Sign up</h2> -->

        <label for="firstname">First name</label>
        <input type="text" name="firstname" require placeholder="First name">
        <div class="firstname error"></div>

        <label for="lastname">Last name</label>
        <input type="text" name="lastname" required placeholder="Last name">
        <div class="lastname error"></div>

        <label for="email">Email</label>
        <input type="text" name="email" required placeholder="Email address">
        <div class="email error"></div>

        <!-- <label for="github">GitHub</label>
        <input type="text" name="github" placeholder="Link Github"> -->

        <!-- <label for="profilpicture">Profile picture</label>
    <input type="file" name="profilpicture"> -->

        <!-- <label for="cv">CV (pdf)</label>
        <input type="text" name="cv" placeholder="Link of your CV (ex: Google Drive)"> -->

        <label for="password">Password</label>
        <input type="password" name="password" required placeholder="Password">
        <div class="password error"></div>

        <label for="confirmpassword">Confirm password</label>
        <input type="password" name="confirmpassword" required class="password-input1" placeholder="Confirm password" />
        <div class="confirmpassword error"></div>

        <button class="btn-login-push">Signup</button>
        <p class="notregistered">
          Already registered?
          <a href="/login">Log in</a>
      </form>
    </div>
  </div>

  <footer class="footer-signup">
    <div>
      © Copyright 2023 - Team MAH
    </div>
  </footer>

  </body>

  </html>

  <script>
    window.addEventListener("orientationchange", function () {
      // Bloquer le retournement de l'écran
      if (window.orientation !== 0) {
        document.documentElement.style.width = window.innerHeight + "px";
        alert("L'inversion d'écran n'est pas autorisée durant l'inscription. Veuillez remettre votre écran en position verticale.");
      }
      else {
        document.documentElement.style.width = "auto";
      }
    });



    const form = document.querySelector('form');
    const emailError = document.querySelector('.email.error');
    const passwordError = document.querySelector('.password.error');
    const confirmPasswordError = document.querySelector('.confirmpassword.error');
    const firstnameError = document.querySelector('.firstname.error');
    const lastnameError = document.querySelector('.lastname.error');


    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // reset errors
      emailError.textContent = '';
      passwordError.textContent = '';
      confirmPasswordError.textContent = '';
      firstnameError.textContent = '';
      lastnameError.textContent = '';

      // get values
      const email = form.email.value;
      const password = form.password.value;
      const confirmpassword = form.confirmpassword.value;
      const firstname = form.firstname.value
      const lastname = form.lastname.value
      // const github = form.github.value
      // const profilpicture = form.profilpicture.value
      // const cv = form.cv.value


      const emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
      if (password !== confirmpassword || !emailRegex.test(email) || firstname === '' || lastname === '') {
        if (password !== confirmpassword) {
          confirmPasswordError.textContent = 'Passwords do not match';
        }
        if (!emailRegex.test(email)) {
          emailError.textContent = 'Email is not valid';
        }
        if (firstname === '') {
          firstnameError.textContent = 'First name is required';
        }
        if (lastname === '') {
          lastnameError.textContent = 'Last name is required';
        }
      } else {
        let infoUsers = {
          firstname,
          lastname,
          email,
          password,
          linkedin: "",
          github: "",
          profilpicture: "",
          cv: ""
        }
        try {
          const res = await fetch('/signup', {
            method: 'POST',
            body: JSON.stringify(infoUsers),
            headers: { 'Content-Type': 'application/json' }
          });
          const data = await res.json();
          console.log(data);
          if (data.errors) {
            emailError.textContent = data.errors.email;
            passwordError.textContent = data.errors.password;
          }
          if (data.user) {
            location.assign('/');
          }

        }
        catch (err) {
          console.log(err);
        }
      }

    });
  </script>